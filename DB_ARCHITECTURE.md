# üîÑ –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
**–ü—Ä–∏—á–∏–Ω–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ä–∞–≤–Ω–∏–≤–∞–ª–∞ –ø–æ `name|category` –≤–º–µ—Å—Ç–æ ID –∏–∑ –ë–î

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `dbId` (ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö) –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ü–æ—Ç–µ—Ä—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏ –ë–î —Ç–æ–≤–∞—Ä–∞–º–∏
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è `dbId` –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–µ–º `dbId` –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. **–î–≤–∞ —Ç–∏–ø–∞ ID:**

- **`id`** - –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤)
- **`dbId`** - ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL (–≤—Å–µ–≥–¥–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π)

### 2. **–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:**

```javascript
// –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –µ—Å–ª–∏:
- id < 0 (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π ID)
- –ò–õ–ò dbId === null
- –ò–õ–ò —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –ø–æ dbId
```

### 3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ ID (–ª—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞):**

```
1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ –ë–î ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º dbId
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å –ë–î –ø–æ dbId
3. UPDATE - –µ—Å–ª–∏ dbId –µ—Å—Ç—å –≤ –ë–î –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
4. INSERT - –µ—Å–ª–∏ dbId –Ω–µ—Ç (–Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä)
5. DELETE - –µ—Å–ª–∏ –≤ –ë–î –µ—Å—Ç—å —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
```

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ID –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏:**

- –ü–æ—Å–ª–µ INSERT –ø–æ–ª—É—á–∞–µ–º ID –∏–∑ –ë–î
- –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ID —Å –Ω–æ–≤—ã–º–∏ ID –∏–∑ –ë–î
- –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ ID

## üìã –ê–ª–≥–æ—Ä–∏—Ç–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
```javascript
const existingItems = await supabase.from('items').select('*').eq('user_id', user.id)
const existingItemsMap = new Map(existingItems.map(item => [item.id, item]))
```

### –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä:
const dbId = localItem.dbId || (localItem.id > 0 ? localItem.id : null)

if (id < 0 || !dbId || !existingItemsMap.has(dbId)) {
  // INSERT - –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
} else if (–¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å) {
  // UPDATE - –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
}
```

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
1. DELETE (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –ë–î, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ)
2. UPDATE (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–æ ID)
3. INSERT (–Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã)

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö ID
```javascript
// –ü–æ—Å–ª–µ INSERT –ø–æ–ª—É—á–∞–µ–º ID –∏–∑ –ë–î –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
const insertedItems = await supabase.insert(...).select()
// –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ID —Å –Ω–æ–≤—ã–º–∏ ID –∏–∑ –ë–î
```

## üîí –ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ:**
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ UPDATE/INSERT –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î
   - –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º ID –∏–∑ –ë–î –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
   - –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ID —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

3. **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:**
   - DELETE ‚Üí UPDATE ‚Üí INSERT
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ID –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏

4. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   - –°–æ—Ö—Ä–∞–Ω—è–µ–º `dbId` –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ ID, –∞ –Ω–µ –ø–æ name+category

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
2. ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ ID
3. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∏ —Å –ë–î –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
5. ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º —Ä–∞–±–æ—Ç—ã —Å –ë–î

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞:
```javascript
// –¢–æ–≤–∞—Ä –∏–∑ –ë–î: { id: 5, dbId: 5, name: "–¢–æ–≤–∞—Ä" }
// –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º dbId
// –†–µ–∑—É–ª—å—Ç–∞—Ç: { id: 5, dbId: 5, name: "–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä" }
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: UPDATE WHERE id = 5 ‚úÖ
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:
```javascript
// –°–æ–∑–¥–∞–µ–º: { id: -1, dbId: null, name: "–ù–æ–≤—ã–π" }
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: INSERT ‚Üí –ø–æ–ª—É—á–∞–µ–º id: 10 –∏–∑ –ë–î
// –û–±–Ω–æ–≤–ª—è–µ–º: { id: 10, dbId: 10, name: "–ù–æ–≤—ã–π" } ‚úÖ
```

### –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:
```javascript
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ ID
// –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–Ω–∏ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –ë–î
// –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ ID –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã ‚úÖ
```

